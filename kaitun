--[[
   Blox Fruits Kaitun Mejorado: Marines auto, farm real, fast mode, limitador FPS
   EDUCACIONAL. Usar esto puede resultar en ban.
--]]

-- === LIMITADOR FPS Y OPTIMIZACIÓN ===
if setfpscap then setfpscap(20) end

for _,v in pairs(game:GetDescendants()) do
    if v:IsA("ParticleEmitter") or v:IsA("Trail") then
        v.Enabled = false
    elseif v:IsA("Explosion") then
        v.Visible = false
    elseif v:IsA("Decal") or v:IsA("Texture") then
        v.Transparency = 1
    elseif v:IsA("Sound") then
        v.Volume = 0
    end
end
if game.Lighting then
    game.Lighting.FogEnd = 1e6
    game.Lighting.GlobalShadows = false
    game.Lighting.Brightness = 1
end

-- === AUTOSELECCIÓN DE BANDO: MARINES ===
local Players = game:GetService("Players")
local player = Players.LocalPlayer

local function SwitchToMarines()
    -- Detecta el botón Marines y lo pulsa si hace falta
    local StarterGui = game:GetService("StarterGui")
    local rep = game:GetService("ReplicatedStorage")
    local teams = {"Pirates", "Marines"}
    local marineBtn = nil

    -- Intenta hacerlo vía RemoteEvent, método universal
    pcall(function()
        if player.Team == nil or player.Team.Name ~= "Marines" then
            local Remote = rep:FindFirstChild("Remotes")
            if Remote and Remote:FindFirstChild("CommF_") then
                Remote.CommF_:InvokeServer("SetTeam", "Marines")
            end
        end
    end)

    -- Intenta hacerlo vía TeamGui si existe
    if player.Team == nil or player.Team.Name ~= "Marines" then
        local gui = player.PlayerGui:FindFirstChild("Main")
        if gui and gui:FindFirstChild("ChooseTeam") then
            for _,btn in pairs(gui.ChooseTeam:GetDescendants()) do
                if btn:IsA("TextButton") and btn.Text:lower():find("marine") then
                    btn:Activate()
                end
            end
        end
    end

    -- Forzar set neutral false si es necesario
    if player.Team == nil or player.Team.Name ~= "Marines" then
        player.Neutral = false
    end
end

SwitchToMarines()

-- Espera a que se asigne el bando
repeat wait() until player.Team and player.Team.Name == "Marines"

-- === FARMEO AUTOMÁTICO REAL (INICIO SIMPLE, PRIMERA ISLA) ===
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local char = player.Character or player.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local root = char:WaitForChild("HumanoidRootPart")

local function findQuestNPC()
    for _,v in pairs(Workspace.NPCs:GetChildren()) do
        if v.Name:find("Quest") or v.Name:find("Officer") then
            return v
        end
    end
    return nil
end

local function getBandit()
    for _,mob in pairs(Workspace.Enemies:GetChildren()) do
        if mob.Name:lower():find("bandit") and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
            return mob
        end
    end
    return nil
end

local function takeQuest()
    local Remote = ReplicatedStorage:FindFirstChild("Remotes")
    if Remote and Remote:FindFirstChild("CommF_") then
        -- Primer quest en la isla inicial: BanditQuest1
        Remote.CommF_:InvokeServer("StartQuest", "BanditQuest1", 1)
    end
end

local function attackMob(mob)
    if mob and mob:FindFirstChild("HumanoidRootPart") then
        root.CFrame = mob.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
        for i=1,3 do
            -- Simular ataque con click remoto (puedes poner tu propio método de ataque)
            local tool = player.Character:FindFirstChildOfClass("Tool")
            if tool then
                tool:Activate()
            end
            mob.Humanoid.Health = mob.Humanoid.Health - 100 -- simula daño
            wait(0.25)
        end
    end
end

-- Bucle de farmeo básico
task.spawn(function()
    while true do
        local bandit = getBandit()
        if not bandit then
            -- No hay bandits vivos, intenta tomar quest y respawnear
            takeQuest()
            wait(1.5)
        else
            attackMob(bandit)
        end
        wait(0.1)
    end
end)

print("Kaitun Marines activo: FPS limitado, fast mode, farm y auto-marines.")
